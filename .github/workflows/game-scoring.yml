 name: NFL Game Scoring

  on:
    schedule:
      - cron: '0,15,30,45 0-4 * * 5'
      - cron: '0,15,30,45 17-23 * * 0'
      - cron: '0,15,30 0-3 * * 1'
      - cron: '0,15,30,45 0-4 * * 2'
    workflow_dispatch:

  jobs:
    score-games:
      runs-on: ubuntu-latest
      steps:
        - name: Score Completed NFL Games
          run: |
            echo "üèà Checking for completed NFL games..."

            response=$(curl -s -w "%{http_code}" -X POST "${{ secrets.VERCEL_APP_URL }}/api/scoring/auto" \
              -H "Content-Type: application/json" \
              -o response.json)

            http_code=$(echo $response | tail -c 4)

            if [ "$http_code" = "200" ]; then
              echo "‚úÖ Scoring completed successfully"
              cat response.json | jq . || cat response.json
            else
              echo "‚ùå Scoring failed with HTTP $http_code"
              cat response.json
              exit 1
            fi

        - name: Log Results
          if: always()
          run: |
            echo "üìä Scoring job completed at $(date)"
            echo "üîó App URL: ${{ secrets.VERCEL_APP_URL }}"
